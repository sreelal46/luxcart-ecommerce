<style>
  .admin-table tbody tr {
    height: 84px;
  }

  .admin-table th,
  .admin-table td {
    padding: 16px 18px;
    vertical-align: middle;
  }

  .admin-table .badge {
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 600;
  }

  .tooltip-inner {
    background-color: #000;
    color: #fff;
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 500;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
  }

  .tooltip.bs-tooltip-top .tooltip-arrow::before {
    border-top-color: #000;
  }
</style>

<div class="container py-5">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Coupons Management</h2>
    <button class="btn btn-primary btn-md  shadow-sm" data-bs-toggle="modal" data-bs-target="#addCouponModal">
      <i class="bi bi-plus-circle me-2"></i> Add Coupon
    </button>
  </div>

  <!-- Coupons Table Card -->
  <div class="card shadow-sm mb-5 border-0">
    <div class="card-body table-responsive p-0">

      <table class="table table-hover align-middle mb-0 admin-table">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Coupon Code</th>
            <th>Discount</th>
            <th>Min Order</th>
            <th>Valid Period</th>
            <th>Usage</th>
            <th>Status</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>

        <tbody id="couponsTableBody">
          {{#each coupons}}
          <tr>
            <td class="fw-semibold text-muted">{{inc @index}}</td>

            <td class="fw-semibold text-dark">
              {{this.code}}
            </td>

            <td>
              {{#if (eq this.discountType "percentage")}}
              <span class="badge bg-success-subtle text-success">
                {{this.discountValue}}%
              </span>
              {{else}}
              <span class="badge bg-info-subtle text-info">
                ₹{{formatPrice this.discountValue}}
              </span>
              {{/if}}
            </td>

            <td class="text-muted">
              ₹{{formatPrice this.minOrderAmount}}
            </td>

            <td class="text-muted text-nowrap">
              {{formattedDate this.validFrom}} – {{formattedDate this.validTo}}
            </td>

            <td>
              <span class="badge bg-secondary-subtle text-secondary">
                {{this.usedBy.length}}
              </span>
            </td>

            <td>
              {{#if this.isActive}}
              <span class="badge bg-success-subtle text-success">Active</span>
              {{else}}
              <span class="badge bg-danger-subtle text-danger">Inactive</span>
              {{/if}}
            </td>

            <td class="text-center">
              <div class="d-flex justify-content-center gap-2">

                <!-- EDIT -->
                <button class="btn btn-sm btn-outline-success edit-coupon-btn" data-bs-toggle="modal"
                  data-bs-target="#editCouponModal" data-id="{{this._id}}" data-code="{{this.code}}"
                  data-discounttype="{{this.discountType}}" data-discountvalue="{{this.discountValue}}"
                  data-minorder="{{this.minOrderAmount}}" data-validfrom="{{this.validFrom}}"
                  data-validto="{{this.validTo}}" data-active="{{this.isActive}}">
                  <i class="bi bi-pencil"></i>
                </button>

                <!-- DELETE -->
                <button class="btn btn-sm btn-outline-danger delete-coupon-btn" data-bs-toggle="modal"
                  data-bs-target="#deleteCouponModal" data-id="{{this._id}}" data-code="{{this.code}}">
                  <i class="bi bi-trash"></i>
                </button>

              </div>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>


    </div>
  </div>

</div>

<!-- Add Coupon Modal -->
<div class="modal fade" id="addCouponModal" tabindex="-1" aria-labelledby="addCouponModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold" id="addCouponModalLabel"><i class="bi bi-plus-circle me-2"></i> Add New Coupon
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="addCouponForm">
          <div class="row g-3">

            <!-- Coupon Code -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Coupon Code</label>
              <input type="text" class="form-control form-control-lg text-uppercase" name="code">
            </div>

            <!-- Discount Type -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Type</label>
              <select class="form-select form-select-lg" name="discountType" id="discountType">
                <option value="">Select Type</option>
                <option value="percentage">Percentage</option>
                <option value="flat">Fixed Amount</option>
              </select>
            </div>

            <!-- Discount Value -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Value</label>
              <input type="number" class="form-control form-control-lg" name="discount" min="1">
            </div>

            <!-- Minimum Order -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Minimum Order Amount (₹)</label>
              <input type="number" class="form-control form-control-lg" name="minOrderAmount" min="0">
            </div>

            <!-- Total Usage Limit -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Total Usage Limit</label>
              <input type="number" class="form-control form-control-lg" name="usageLimit" min="1">
            </div>

            <!-- Per User Limit -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Usage Per User</label>
              <input type="number" class="form-control form-control-lg" name="perUserLimit" min="1">
            </div>

            <!-- Status -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Status</label>
              <select class="form-select form-select-lg" name="isActive">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>

            <!-- Valid From -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Valid From</label>
              <input type="date" class="form-control form-control-lg" name="validFrom">
            </div>

            <!-- Valid To -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Valid To</label>
              <input type="date" class="form-control form-control-lg" name="validTo">
            </div>

          </div>

          <div class="text-end mt-4">
            <button type="button" class="btn btn-secondary btn-lg me-2" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary btn-lg ">Add Coupon</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Edit Coupon Modal -->
<div class="modal fade" id="editCouponModal" tabindex="-1" aria-labelledby="editCouponModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content rounded-4 shadow-lg">

      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fw-bold" id="editCouponModalLabel">
          <i class="bi bi-pencil-square me-2"></i> Edit Coupon
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="editCouponForm">
          <div class="row g-3">

            <!-- Coupon Code -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Coupon Code</label>
              <input type="text" class="form-control form-control-lg text-uppercase" name="code">
            </div>

            <!-- Discount Type -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Type</label>
              <select class="form-select form-select-lg" name="discountType" id="editDiscountType">
                <option value="percentage">Percentage</option>
                <option value="fixed">Fixed Amount</option>
              </select>
            </div>

            <!-- Discount Value -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Value</label>
              <input type="number" class="form-control form-control-lg" name="discount" min="1">
            </div>

            <!-- Minimum Order -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Minimum Order Amount (₹)</label>
              <input type="number" class="form-control form-control-lg" name="minOrderAmount" min="0">
            </div>

            <!-- Total Usage -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Total Usage Limit</label>
              <input type="number" class="form-control form-control-lg" name="usageLimit" min="1">
            </div>

            <!-- Per User -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Usage Per User</label>
              <input type="number" class="form-control form-control-lg" name="perUserLimit" min="1">
            </div>

            <!-- Status -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Status</label>
              <select class="form-select form-select-lg" name="isActive">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>

            <!-- Valid From -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Valid From</label>
              <input type="date" class="form-control form-control-lg" name="validFrom">
            </div>

            <!-- Valid To -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Valid To</label>
              <input type="date" class="form-control form-control-lg" name="validTo">
            </div>

          </div>

          <div class="text-end mt-4">
            <button type="button" class="btn btn-secondary btn-lg me-2" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-warning btn-lg">Update Coupon</button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>



<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteCouponModal" tabindex="-1" aria-labelledby="deleteCouponModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title fw-bold" id="deleteCouponModalLabel"><i class="bi bi-exclamation-triangle-fill me-2"></i>
          Delete Coupon</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="fs-6">Are you sure you want to delete the coupon <strong id="deleteCouponName"></strong>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger rounded-pill" id="confirmDeleteCoupon">Delete</button>
      </div>
    </div>
  </div>
</div>
<script src="/js/admin/couponsManagement.js"></script>