<style>
  #adminPassword {
    height: 45px;
  }
</style>

<div class="min-vh-100 d-flex align-items-center justify-content-center"
  style="background: url('/images/car-bg.jpg') no-repeat center center; background-size: cover;">

  <div class="bg-white rounded-3 shadow p-5" style="max-width: 400px; width: 100%;">
    <div class="text-center mb-4">
      <h2 class="fw-bold text-dark">Admin Panel</h2>
      <h1 class="h5 fw-bold mt-2 mb-1">Sign in to Admin Account</h1>
      <p class="text-muted mb-0">Restricted access only</p>
    </div>

    <div id="alert" class="d-none text-center"></div>

    <form class="mt-4" id="loginForm" novalidate>

      <!-- Email -->
      <div class="mb-3">
        <label for="adminEmail" class="form-label fw-medium small">Admin Email</label>
        <input type="email" class="form-control" id="adminEmail" name="email" placeholder="admin@example.com" required>
        <div id="emailError" class="text-danger small mt-1"></div>
      </div>

      <!-- Password -->
      <label for="adminPassword" class="form-label fw-medium small">Password</label>

      <div class="position-relative mb-0">
        <input type="password" class="form-control" id="adminPassword" name="password" placeholder="Enter your password"
          required minlength="8">

        <span class="toggle-eye position-absolute" data-target="adminPassword"
          style="right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer;">
          <i class="bi bi-eye-slash"></i>
        </span>
      </div>

      <div id="passwordError" class="text-danger small mt-1"></div>

      <div class="d-flex justify-content-between align-items-center mb-3 mt-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="rememberAdmin">
          <label class="form-check-label small text-muted" for="rememberAdmin">
            Remember me
          </label>
        </div>
        <a href="/admin/verify-email-page" class="small text-dark text-decoration-none">Forgot password?</a>
      </div>

      <button type="submit" class="btn btn-dark w-100 fw-medium">Admin Sign In</button>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {

    const adminLoginForm = document.getElementById("loginForm");
    const emailInput = document.getElementById("adminEmail");
    const passwordInput = document.getElementById("adminPassword");

    const emailError = document.getElementById("emailError");
    const passwordError = document.getElementById("passwordError");
    const alertDiv = document.getElementById("alert");

    /* =====================================
                  EYE TOGGLE
     ===================================== */
    document.querySelector(".toggle-eye").addEventListener("click", function () {
      const input = document.getElementById(this.dataset.target);

      if (input.type === "password") {
        input.type = "text";
        this.innerHTML = '<i class="bi bi-eye"></i>';
      } else {
        input.type = "password";
        this.innerHTML = '<i class="bi bi-eye-slash"></i>';
      }
    });

    /* =====================================
                VALIDATION
     ===================================== */

    const validateEmail = (email) =>
      /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

    function emailValidation() {
      const email = emailInput.value.trim();

      if (!email) {
        emailError.textContent = "Email is required";
        return false;
      } else if (!validateEmail(email)) {
        emailError.textContent = "Invalid email format.";
        return false;
      }

      emailError.textContent = "";
      return true;
    }

    function passwordValidation() {
      const password = passwordInput.value.trim();

      if (!password) {
        passwordError.textContent = "Password is required";
        return false;
      } else if (password.length < 8) {
        passwordError.textContent = "Password must be at least 8 characters.";
        return false;
      }

      passwordError.textContent = "";
      return true;
    }

    emailInput.addEventListener("input", emailValidation);
    passwordInput.addEventListener("input", passwordValidation);

    /* =====================================
                FORM SUBMIT
     ===================================== */

    adminLoginForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const emailValid = emailValidation();
      const passwordValid = passwordValidation();

      if (!emailValid || !passwordValid) return;

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      try {
        const res = await axios.post("/admin/login", { email, password }, { withCredentials: true });

        alertDiv.classList.remove("d-none");

        if (res.data.success) {
          alertDiv.className = "alert alert-success text-center";
          alertDiv.textContent = "Login successful! Redirecting...";
          setTimeout(() => (window.location.href = res.data.redirect), 400);
        } else {
          alertDiv.className = "alert alert-danger text-center";
          alertDiv.textContent = res.data.message || "Invalid credentials.";
        }

      } catch (err) {
        alertDiv.classList.remove("d-none");
        alertDiv.className = "alert alert-danger text-center";
        alertDiv.textContent = err.response?.data?.message || "Server error. Please try again.";
      }
    });

  });
</script>