<div class="container py-5">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">Users Management</h2>
  </div>

  <!-- Search & Filter -->
  <div class="d-flex justify-content-between mb-3">
    <input type="text" id="searchUserInput" class="form-control w-50" placeholder="Search by name or email">
    <!-- <button class="btn btn-primary ms-2" data-bs-toggle="modal" data-bs-target="#filterUserModal">
      <i class="bi bi-funnel"></i> Filter
    </button> -->
  </div>

  <!-- Users Table Card -->
  <div class="card shadow-sm rounded-4 p-4">
    <div class="table-responsive">
      <table class="table table-hover align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>User</th>
            <th>Status</th>
            <th>Total Orders</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          {{#each users}}
          <tr>
            <td>{{inc @index}}</td>
            <td class="d-flex align-items-center">
              <img src="{{this.avatarUrl}}" class="rounded-circle me-2" alt="profile"
                style="width:36px;height:36px;object-fit:cover;">
              <div class="text-start">
                <div class="fw-bold">{{this.name}}</div>
                <small class="text-muted">{{this.email}}</small>
              </div>
            </td>
            {{#if this.isBlocked}}
            <td><span class="badge bg-danger">Blocked</span></td>
            {{else}}
            <td><span class="badge bg-success">Active</span></td>
            {{/if}}
            <td>{{this.orderCount}}</td>
            <td>
              <a href="/admin/users-management/user-details/{{this._id}}" style="text-decoration: none;">
                <button class="btn btn-sm btn-info rounded-pill me-1"><i class="bi bi-eye-fill"></i> View</button>
              </a>
              {{#if this.isBlocked}}
              <button class="btn btn-sm btn-warning rounded-pill" data-bs-toggle="modal"
                data-bs-target="#blockUserModal" data-id="{{this._id}}" data-user="{{this.name}}"
                data-action="unblock">Unblock</button>
              {{else}}
              <button class="btn btn-sm btn-warning rounded-pill" data-bs-toggle="modal"
                data-bs-target="#blockUserModal" data-id="{{this._id}}" data-user="{{this.name}}"
                data-action="block">Block</button>
              {{/if}}
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <nav class="mt-3">
      <ul class="pagination justify-content-center" id="usersPagination"></ul>
    </nav>

  </div>

  <!-- Filter Modal -->
  <div class="modal fade" id="filterUserModal" tabindex="-1" aria-labelledby="filterUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="filterUserModalLabel"><i class="bi bi-funnel me-2"></i> Filter Users</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="filterUserForm">
            <div class="mb-3">
              <label class="form-label fw-semibold">Status</label>
              <select class="form-select" name="status">
                <option value="">All</option>
                <option value="Active">Active</option>
                <option value="Blocked">Blocked</option>
              </select>
            </div>
            <div class="text-end mt-3">
              <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Apply Filter</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Block/Unblock Confirmation Modal -->
  <div class="modal fade" id="blockUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header border-0">
          <h5 class="modal-title"><span id="blockActionText">block</span> user</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to <strong id="blockActionText2">block</strong>
          <span class="fw-semibold" id="blockUserName"></span>?
        </div>
        <div class="modal-footer border-0">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" id="confirmBlockUser">Yes, Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->

  <script src="/js/admin//users/usersManagement.js"></script>


  <!-- <script>
  // Search functionality
  document.getElementById('searchUserInput').addEventListener('keyup', function () {
    const searchText = this.value.toLowerCase();
    const rows = document.querySelectorAll('#usersTableBody tr');
    rows.forEach(row => {
      const rowText = row.innerText.toLowerCase();
      row.style.display = rowText.includes(searchText) ? '' : 'none';
    });
  });

  // Populate Block/Unblock modal
  const blockUserModal = document.getElementById('blockUserModal');
  let currentAction = '';
  let currentUser = '';
  let currentUserId;

  blockUserModal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    currentAction = button.getAttribute('data-action'); // block or unblock
    currentUser = button.getAttribute('data-user');
    currentUserId = button.getAttribute('data-id');

    document.getElementById('blockUserName').textContent = currentUser;
    document.getElementById('blockActionText').textContent = currentAction;
  });

  document.getElementById('confirmBlockUser').addEventListener('click', async function () {
    try {
      // API request
      const res = await axios.patch(`/admin/users-management/block-unblock-user/${currentUserId}`);

      if (res.data.success) {
        await Swal.fire({
          title: `User ${res.data.status === 'Block' ? 'Blocked' : 'Unblocked'}!`,
          text: `${currentUser} has been successfully ${res.data.status === 'Block' ? 'blocked' : 'unblocked'}.`,
          icon: "success",
          timer: 1800,
          showConfirmButton: false
        });

        // Reload the page to reflect changes
        window.location.reload();
      }
    } catch (error) {
      console.error("Error blocking/unblocking user:", error);

      Swal.fire({
        title: "Error!",
        text: "Something went wrong while updating the user status.",
        icon: "error",
        confirmButtonColor: "#ef4444"
      });
    }

    // Close modal after action
    const modal = bootstrap.Modal.getInstance(blockUserModal);
    modal.hide();
  });


</script> -->