<link rel="stylesheet" href="/css/user/account/cart.css">

<!-- Slide-in Toast MSG -->
<div id="mobileAlert" class="mobile-alert"></div>

<div class="container py-2">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Your Cart</h2>
  </div>

  {{#if cart.items.length}}
  <div class="row">

    <!-- LEFT: CART ITEMS -->
    <div class="col-lg-8">
      <div class="cart-scroll-area">

        {{#each cart.items}}
        <a class="cart-item-card" href="{{#if this.accessoryId}}
          /all-accessories/view-accessory-product/{{getId this.accessoryId}}
        {{else}}
          /cars-collection/view-car-product/{{getId this.carId}}
        {{/if}}" data-id="{{this._id}}">


          {{!-- IMAGE --}}
          {{#if this.carId}}
          <img src="{{this.variantId.image_url.[0]}}" class="cart-item-img">
          {{else}}
          <img src="{{this.accessoryId.images.[0]}}" class="cart-item-img">
          {{/if}}

          <div class="cart-item-details">

            {{!-- TITLE --}}
            {{#if this.carId}}
            <div class="cart-item-title">{{this.carId.name}}</div>
            <div class="cart-item-meta">Color: {{this.variantId.color}}</div>
            {{else}}
            <div class="cart-item-title">{{this.accessoryId.name}}</div>
            <div class="cart-item-meta">Material: {{this.accessoryId.material}}</div>
            {{/if}}

            {{!-- PRICE --}}
            <div class="price-box">
              <span class="offer-price">₹ {{formatPrice this.price}}</span>
              <span class="original-price">₹ {{formatPrice this.price}}</span>
              <span class="discount">(50% OFF)</span>
            </div>
            <div class="price-box">
              <span class="cart-item-meta">Quantity : </span>
              <span class="cart-item-meta">{{this.quantity}}</span>
            </div>
          </div>

          {{!-- BOTTOM ROW --}}
          <div class="cart-bottom-row">
            {{#if this.accessoryId}}
            <button class="delete-btn remove-acc" data-itemid="{{this._id}}"><i class="bi bi-trash"></i></button>

            <div class="cart-item-meta text-center text-danger" id="errorQuantity" style="display: none;"></div>
            <div class="qty-box" data-item="{{this._id}}">
              <button class="qty-btn minus" data-itemid="{{this._id}}">-</button>
              <span class="qty-value" data-itemid="{{this._id}}" data-qty="{{this.quantity}}">{{this.quantity}}</span>
              <button class="qty-btn plus" data-itemid="{{this._id}}">+</button>

            </div>


            {{else}}
            <button class="delete-btn remove-car" data-itemid="{{this._id}}"><i class="bi bi-trash "></i></button>
            {{/if}}
          </div>

        </a>
        {{/each}}

      </div>
    </div>

    <!-- RIGHT: ORDER SUMMARY -->
    <div class="col-lg-4">
      <div class="order-box">

        <h5 class="fw-bold mb-3">Order Summary</h5>

        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Price ({{cart.items.length}} items)</span>
          <span class="fw-semibold">₹ {{formatPrice cart.totalAmount}}</span>
        </div>

        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Discount</span>
          <span class="fw-semibold">Free</span>
        </div>

        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Shipping</span>
          <span class="fw-semibold">Free</span>
        </div>

        <div class="d-flex justify-content-between mb-3">
          <span class="text-muted">Tax <span class="fw-semibold">(GST {{taxRate}}% Only for Accessory)</span></span>
          <span class="fw-semibold">₹ {{formatPrice cart.accessoryTax}}</span>
        </div>

        <hr>

        <div class="d-flex justify-content-between mb-3">
          <h6 class="fw-bold">Total Amount</h6>
          <h6 class="fw-bold">₹ {{formatPrice cart.totalAfterAll}}</h6>
        </div>

        <button class="btn btn-orange w-100 mb-3">Apply Coupon</button>
        <button class="btn btn-black w-100">Proceed to Checkout</button>

        <p class="text-center text-muted small mt-3">
          By proceeding to checkout, you agree to our <br>
          <a href="#" class="text-decoration-none">Terms of Service</a> and
          <a href="#" class="text-decoration-none">Privacy Policy</a>
        </p>

      </div>
    </div>

  </div>

  {{else}}
  <!-- EMPTY CART -->
  <div class="empty-cart-wrapper">
    <div class="empty-cart-box text-center">

      <img src="/images/emptyCart.svg" class="empty-cart-img" alt="Empty Cart">

      <h3 class="empty-cart-title">Your Cart is Empty</h3>
      <p class="empty-cart-text">Looks like you haven’t added anything yet.</p>

      <a href="/" class="btn btn-dark continue-btn">Continue Shopping</a>

    </div>
  </div>
  {{/if}}

</div>


{{#if cart}}
<!-- MOBILE BOTTOM BAR -->
<div class="mobile-bottom-bar d-md-none">
  <div class="bottom-total fw-bold fs-5">₹ {{formatPrice cart.totalAmount}}</div>
  <button class="place-order-btn btn btn-dark px-4 py-2 rounded-3">Place Order</button>
</div>
{{/if}}

<script src="/js/user/account/cart.js"></script>