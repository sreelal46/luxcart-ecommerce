<style>
  /* =========================
     ORDER HISTORY CARD
  ========================= */
  .order-card-front {
    margin-bottom: 18px;
    background: #fff;
    border-radius: 18px;
    padding: 22px 26px;
    box-shadow: 0 10px 28px rgba(0, 0, 0, 0.08);
  }

  /* =========================
     GRID LAYOUT
  ========================= */
  .order-row-header {
    display: grid;
    grid-template-columns: 140px 1.2fr 1fr 1fr 140px;
    align-items: center;
    gap: 24px;
  }

  /* =========================
     IMAGE STACK
  ========================= */
  .order-image-stack {
    position: relative;
    width: 110px;
    height: 90px;
  }

  .order-image-stack img {
    position: absolute;
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 14px;
    background: #fff;
    border: 1px solid #e6e6e6;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  /* FRONT IMAGE */
  .order-image-stack img:nth-child(1) {
    z-index: 3;
    top: 0;
    left: 0;
  }

  /* BACK IMAGE (small visible part) */
  .order-image-stack img:nth-child(2) {
    z-index: 1;
    top: 10px;
    left: 18px;
    /* controls how much shows */
    opacity: 0.95;
  }

  /* HIDE EXTRA IMAGES */
  .order-image-stack img:nth-child(n+3) {
    display: none;
  }

  /* =========================
     TEXT STYLES
  ========================= */
  .label {
    font-size: 12px;
    color: #8b8f97;
    margin-bottom: 4px;
  }

  .value {
    font-size: 15px;
    font-weight: 600;
    color: #111;
  }

  .order-total {
    text-align: right;
  }

  .order-action {
    text-align: right;
  }

  .order-action .btn {
    padding: 8px 16px;
    border-radius: 10px;
    font-size: 14px;
  }

  /* =========================
     MOBILE VIEW
  ========================= */
  @media (max-width: 768px) {
    .order-row-header {
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .order-image-stack {
      width: 100%;
      height: 160px;
    }

    .order-image-stack img {
      width: 140px;
      height: 140px;
    }

    .order-total,
    .order-action {
      text-align: left;
    }
  }
</style>

<section id="orders" class="main-card">
  <h5 class="mb-3">Order History</h5>

  {{#each orders}}
  <div class="order-card-front">

    <div class="order-row-header">

      <!-- IMAGE STACK -->
      <div class="order-image-stack">
        {{#each this.items}}
        {{#if this.carId}}
        <img src="{{this.variantId.image_url.[0]}}" alt="Product">
        {{else}}
        <img src="{{this.accessoryId.images.[0]}}" alt="Product">
        {{/if}}
        {{/each}}
      </div>

      <!-- ORDER ID -->
      <div>
        <div class="label">Order ID</div>
        <div class="value">{{this.orderId}}</div>
      </div>

      <!-- DATE -->
      <div>
        <div class="label">Date</div>
        <div class="value">{{formattedDate this.createdAt}}</div>
      </div>

      <!-- TOTAL / REFUND -->
      <div class="order-total">
        {{#if this.totalRefundAmount}}
        <div class="label">Refund Total</div>
        <div class="value">₹ {{formatPrice this.totalRefundAmount}}</div>
        {{else}}
        <div class="label">Total</div>
        <div class="value">₹ {{formatPrice this.totalAmount}}</div>
        {{/if}}
      </div>

      <!-- ACTION -->
      <div class="order-action">
        <a href="/account/orders/order-details/{{this._id}}" class="btn btn-outline-dark btn-sm">
          View Details
        </a>
      </div>

    </div>

  </div>
  {{/each}}
</section>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".order-image-stack").forEach(stack => {
      const images = stack.querySelectorAll("img");

      if (images.length > 1) {
        // pick random image index
        const randomIndex = Math.floor(Math.random() * images.length);

        // move random image to front
        const selectedImage = images[randomIndex];
        stack.insertBefore(selectedImage, images[0]);
      }
    });
  });
</script>