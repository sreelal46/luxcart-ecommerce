<style>
  .main-card {
    background: #ffffff;
    box-shadow: 0 8px 24px rgba(15, 23, 36, 0.06);
    padding: 20px;
    border-radius: 8px;
  }

  .error {
    color: red;
    font-size: 12px;
    margin-top: 4px;
  }

  .invalid {
    border-color: red !important;
  }

  /* =======================
        CUSTOM SWAL POPUP
    ======================== */
  .custom-swal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.45);
    backdrop-filter: blur(3px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 99999;
  }

  .custom-swal-backdrop.show {
    display: flex;
  }

  .custom-swal-box {
    width: 820px;
    background: #fff;
    padding: 24px 30px;
    border-radius: 12px;
    width: 330px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
    animation: popIn 0.25s ease-out;
  }

  .custom-swal-box.error {
    border-top: 6px solid #e74c3c;
  }

  .error-btn {
    margin-top: 20px;
    padding: 10px 20px;
    background: #e74c3c;
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
  }

  .error-btn:hover {
    background: #c0392b;
  }
</style>

<!-- ==========================
       ADDRESS FORM
  =========================== -->
<form id="addressForm" class="row g-3 main-card mt-4" novalidate>
  <div class="col-md-6">
    <label class="form-label">Full Name*</label>
    <input id="fullName" class="form-control" value="{{address.fullName}}" placeholder="Enter your full name">
    <div class="error" id="fullNameError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">Email*</label>
    <input id="email" class="form-control" value="{{address.email}}" placeholder="Enter your email">
    <div class="error" id="emailError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">Phone Number*</label>
    <input id="phone" class="form-control" value="{{address.phone}}" placeholder="Enter your phone number">
    <div class="error" id="phoneError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">Address Label*</label>
    <input id="label" class="form-control" value="{{address.label}}" placeholder="Home, Office, etc.">
    <div class="error" id="labelError"></div>
  </div>

  <div class="col-12">
    <label class="form-label">Street Address*</label>
    <input id="street" class="form-control" value="{{address.street}}" placeholder="Street address">
    <div class="error" id="streetError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">Landmark*</label>
    <input id="landmark" class="form-control" value="{{address.landmark}}" placeholder="Landmark">
    <div class="error" id="landmarkError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">City*</label>
    <input id="city" class="form-control" value="{{address.city}}" placeholder="City">
    <div class="error" id="cityError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">District*</label>
    <input id="district" class="form-control" value="{{address.district}}" placeholder="District">
    <div class="error" id="districtError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">State/Province*</label>
    <input id="state" class="form-control" value="{{address.state}}" placeholder="State/Province">
    <div class="error" id="stateError"></div>
  </div>

  <div class="col-md-6">
    <label class="form-label">ZIP/Postal Code*</label>
    <input id="zip" class="form-control" value="{{address.pinCode}}" placeholder="ZIP/Postal Code">
    <div class="error" id="zipError"></div>
  </div>

  <input id="addressId" type="hidden" value="{{address._id}}">

  <div class="col-md-6 d-flex align-items-end justify-content-end">
    <button type="button" class="btn btn-outline-dark me-2" id="cancelBtn">Cancel</button>
    <button type="submit" class="btn btn-dark">Save Address</button>
  </div>
</form>

<!-- ==========================
       CUSTOM ERROR SWAL 
     ==========================-->
<div id="customSwalError" class="custom-swal-backdrop">
  <div class="custom-swal-box error">
    <h3 id="customSwalErrorTitle">Error</h3>
    <p id="customSwalErrorText">Something went wrong.</p>
    <button id="customSwalErrorBtn" class="error-btn">OK</button>
  </div>
</div>



<!-- ==========================
          JAVASCRIPT
  ========================== -->
<script>
  const fields = [
    'fullName', 'email', 'phone', 'label', 'street',
    'landmark', 'city', 'district', 'state', 'zip'
  ];

  function validateField(id) {
    const value = document.getElementById(id).value.trim();
    const error = document.getElementById(id + 'Error');
    const input = document.getElementById(id);

    if (!value) {
      error.textContent = 'This field is required';
      input.classList.add('invalid');
      return false;
    }

    if (id === 'email' && !/^[^@]+@[^@]+\.[^@]+$/.test(value)) {
      error.textContent = 'Enter a valid email address';
      input.classList.add('invalid');
      return false;
    }

    if (id === 'phone') {
      const v = value;
      if (!/^[6-9]\d{9}$/.test(v)) {
        error.textContent = "Enter valid 10-digit Indian mobile number.";
        input.classList.add("invalid");
        return false;
      }
    }

    if (id === 'zip' && !/^\d{6}$/.test(value)) {
      error.textContent = 'ZIP/Postal Code must be exactly 6 digits';
      input.classList.add('invalid');
      return false;
    }

    error.textContent = '';
    input.classList.remove('invalid');
    return true;
  }

  /* ==========================
    CUSTOM ERROR POPUP
  ========================== */
  const CustomSwal = {};
  CustomSwal.error = (title = "Error", text = "Something went wrong.") => {
    const box = document.getElementById("customSwalError");
    document.getElementById("customSwalErrorTitle").textContent = title;
    document.getElementById("customSwalErrorText").textContent = text;
    box.classList.add("show");
    document.getElementById("customSwalErrorBtn").onclick = () =>
      box.classList.remove("show");
  };



  /* ==========================
    FORM SUBMIT HANDLER
  ========================== */
  fields.forEach(id => {
    document.getElementById(id).addEventListener('input', () => validateField(id));
  });

  document.getElementById('addressForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    let valid = true;
    fields.forEach(id => {
      if (!validateField(id)) valid = false;
    });
    if (!valid) return;

    const addressId = document.getElementById("addressId").value;
    const data = {};
    fields.forEach(id => data[id] = document.getElementById(id).value.trim());

    try {
      const res = await axios.put(`/account/addresses/edit-address/${addressId}`, data);

      if (res.data.success) {
        window.location.href = res.data.redirect

      } else {
        CustomSwal.error("Save Failed", res.data.alert || "Server error occurred.");
      }

    } catch (err) {
      CustomSwal.error("Save Failed", err.response?.data?.alert || "Server error occurred.");
    }
  });

  document.getElementById('cancelBtn').addEventListener('click', () => {
    window.location.href = "/account/addresses"
  });
</script>