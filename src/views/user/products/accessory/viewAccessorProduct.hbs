<!-- Custom stylesheet -->
<link rel="stylesheet" href="/css/user/products/accessory/viewAccessoryProduct.css">

<!-- Slide-in Toast MSG -->
<div id="mobileAlert" class="mobile-alert"></div>

<section class="accessory-page">
  <div class="container">
    <div class="row g-4">

      <!-- LEFT SIDE: IMAGE CAROUSEL -->
      <div class="col-lg-7">
        <div class="accessory-header">
          <h2>{{accessory.name}}</h2>
          <small>{{accessory.brand_id.name}} • {{accessory.category_id.name}} •
            {{accessory.product_type_id.name}}</small>
        </div>

        <!-- Bootstrap Carousel -->
        <div id="accessoryImageCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500"
          data-bs-pause="hover">
          <div class="carousel-inner">
            {{#each accessory.images}}
            <div class="carousel-item {{#if @first}}active{{/if}}">
              <div class="zoom-container">
                <img src="{{this}}" class="d-block w-100 accessory-main-img" style="height: 400px; object-fit: contain;"
                  alt="{{../accessory.name}}">
              </div>
            </div>
            {{/each}}
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#accessoryImageCarousel"
            data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#accessoryImageCarousel"
            data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>

      <!-- RIGHT SIDE: PRICE & DETAILS -->
      <div class="col-lg-5">
        <div class="price-box">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="price">₹{{formatPrice accessory.price}}</div>
            <button id="wishlistBtn" data-accessoryid="{{accessory._id}}"
              style="border: none; background-color: transparent;">
              <i id="heartIcon" class="bi bi-heart fs-5 text-muted"></i>
            </button>
          </div>

          <div class="info-text">Brand: {{accessory.brand_id.name}}</div>
          <div class="info-text">Category: {{accessory.category_id.name}}</div>
          <div class="info-text">Type: {{accessory.product_type_id.name}}</div>
          <div class="info-text">Material: {{accessory.material}}</div>
          <!-- <div class="info-text">Stock: {{accessory.stock}}</div> -->
          <div class="info-text mb-3">Warranty: {{accessory.warranty}}</div>


          <!-- Desktop Buttons -->
          {{#if accessory.stock}}
          {{#if accessory.isListed}}
          <!-- <button class="btn btn-buy" id="buyProductDesk" data-accessoryId="{{accessory._id}}"><i
              class="bi bi-lightning-charge"></i> Buy
            Now</button> -->

          {{#if inCart}}
          <a class="btn btn-cart" href="/cart"><i class="bi bi-cart"></i> Go to Cart</a>
          {{else}}
          <a class="btn btn-cart" id="addToCartDesk" data-accessoryId="{{accessory._id}}"><i class="bi bi-cart"></i> Add
            to Cart</a>
          {{/if}}

          {{else}}
          <div class="p-3 rounded-3 border border-danger bg-light text-danger mt-2 d-flex align-items-center">
            <i class="bi bi-exclamation-octagon-fill fs-5 me-2"></i>
            <span class="fw-semibold">This model is currently unavailable</span>
          </div>
          {{/if}}
          {{else}}
          <div class="p-3 rounded-3 border border-danger bg-light text-danger mt-2 d-flex align-items-center">
            <i class="bi bi-exclamation-octagon-fill fs-5 me-2"></i>
            <span class="fw-semibold">Out of Stock</span>
          </div>
          {{/if}}
        </div>
      </div>
    </div>

    <!-- SINGLE DESCRIPTION SECTION -->
    <div class="description-section mt-5">
      <h4>Description</h4>
      <div class="description-text" id="descriptionText">
        {{{formatDescription accessory.description}}}
      </div>
      <button class="btn btn-outline-dark mt-3" id="toggleDescBtn">Read More</button>
    </div>

    <!-- ACCORDION DETAILS -->
    <div class="accordion-section mt-5">

      <!-- PRODUCT INFO TABLE -->
      <div class="accordion active">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          Product Information <i class="bi bi-chevron-down"></i>
        </div>
        <div class="accordion-content">
          <div class="table-responsive">
            <table class="table product-info-table align-middle">
              <tbody>
                <tr>
                  <th>Country of Origin</th>
                  <td>{{accessory.country_of_origin}}</td>
                </tr>
                <tr>
                  <th>Fabric</th>
                  <td>{{accessory.fabric}}</td>
                </tr>
                <tr>
                  <th>Finish</th>
                  <td>{{accessory.finish}}</td>
                </tr>
                <tr>
                  <th>Fitting</th>
                  <td>{{accessory.fitting}}</td>
                </tr>
                <tr>
                  <th>Waterproof</th>
                  <td>{{#if accessory.waterproof}}Yes{{else}}No{{/if}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- VEHICLE COMPATIBILITY TABLE -->
      <div class="accordion">
        <div class="accordion-header" onclick="toggleAccordion(this)">
          Vehicle Compatibility <i class="bi bi-chevron-down"></i>
        </div>
        <div class="accordion-content">
          <div class="table-responsive">
            <table class="table product-info-table align-middle">
              <tbody>
                <tr>
                  <th>Vehicle</th>
                  <td>{{accessory.vehicle}}</td>
                </tr>
                <tr>
                  <th>Production Year</th>
                  <td>{{accessory.production_year}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!--MOBILE FIXED BUTTONS (visible only on small screens) -->
  <div class="mobile-bottom-bar d-lg-none">
    {{#if accessory.isListed}}
    <div class="action-buttons d-flex gap-2" id="buyProductMob" data-accessoryId="{{accessory._id}}">
      <button class="btn btn-buy flex-fill">
        <i class="bi bi-lightning-charge me-1"></i> Buy Now
      </button>
      <a class="btn btn-cart flex-fill" id="addToCartMob" data-accessoryId="{{accessory._id}}">
        <i class="bi bi-cart me-1"></i> Add to Cart
      </a>
    </div>
    {{else}}
    <div class="unavailable-bar d-flex align-items-center justify-content-center">
      <i class="bi bi-exclamation-octagon-fill fs-6 me-2"></i>
      <span class="fw-semibold small">This model is currently unavailable</span>
    </div>
    {{/if}}
  </div>
</section>

<script src="/js/user/products/accessory/viewAccessoryProduct.js"></script>