<!-- Custom stylesheet -->
<link rel="stylesheet" href="/css/user/products/car/viewCarProduct.css">

<input type="hidden" id="productId" value="{{singleCar._id}}">

<!-- Slide-in Toast MSG -->
<div id="mobileAlert" class="mobile-alert"></div>

<section class="car-page">
  <div class="container">
    <div class="row g-4">

      <!-- LEFT SIDE: CAR IMAGE CAROUSEL -->
      <div class="col-lg-7">
        <div class="car-header">
          <h2>{{singleCar.name}}</h2>
          <small>{{singleCar.year}} • {{singleCar.mileage}} • {{singleCar.region}}</small>
        </div>

        <div id="carImageCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500"
          data-bs-pause="hover">
          <div class="carousel-inner">
            {{#each singleCar.variantIds.[0].image_url}}
            <div class="carousel-item {{#if @first}}active{{/if}}">
              <div class="zoom-container">
                <img src="{{this}}" class="d-block w-100 car-main-img" alt="{{../singleCar.name}}">
              </div>
            </div>
            {{/each}}
          </div>

          <!-- Carousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#carImageCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carImageCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>

      <!-- RIGHT SIDE -->
      <div class="col-lg-5">
        <div class="price-box">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="price">₹ {{formatPrice singleCar.variantIds.[0].price}}</div>
            <i class="bi bi-heart fs-5 text-muted"></i>
          </div>

          <!-- VARIANT BUTTONS -->
          {{#if (gt (length singleCar.variantIds) 1)}}
          <div class="variant-section mb-3">
            <h5 class="fw-semibold mb-3">Variants</h5>
            <div class="variant-section-button d-flex flex-wrap gap-2">
              {{#each singleCar.variantIds}}
              <!-- <button class="variant-btn btn btn-outline-dark {{#if @first}}active{{/if}} "
                data-carid="{{singleCar._id}}" data-color="{{this.color}}" data-price="{{this.price}}"
                data-images='{{{json this.image_url}}}' data-variantId="{{this._id}}" onclick="changeVariant(this)">
                {{this.color}}
              </button> -->
              <button class="variant-btn btn btn-outline-dark {{#if @first}}active{{/if}}" data-variantid="{{this._id}}"
                data-carid="{{singleCar._id}}" onclick="changeVariantReq(this)">{{this.color}} </button>
              {{/each}}
            </div>
          </div>
          {{/if}}

          <div class="info-text">Year: {{singleCar.year}}</div>
          <div class="info-text">Region: {{singleCar.region}}</div>
          <div class="info-text mb-3">Warranty: {{singleCar.warranty}}</div>

          <!-- Desktop Buttons -->
          {{#if singleCar.isListed}}
          <!-- <button class="btn btn-buy" id="buyProductDesk" data-carid="{{singleCar._id}}"
            data-variantId="{{getFirstVariantId singleCar}}"><i class="bi bi-lightning-charge"></i> Buy
            Now</button> -->
          {{#if (includes inCartVariants selectedVariantId)}}
          <a class="btn btn-cart" href="/cart">
            <i class="bi bi-cart"></i> Go to Cart
          </a>
          {{else}}
          <a class="btn btn-cart" id="addToCartDesk" data-carid="{{singleCar._id}}"
            data-variantId="{{selectedVariantId}}">
            <i class="bi bi-cart"></i> Add to Cart
          </a>
          {{/if}}




          {{else}}
          <div class="p-3 rounded-3 border border-danger bg-light text-danger mt-2 d-flex align-items-center">
            <i class="bi bi-exclamation-octagon-fill fs-5 me-2"></i>
            <span class="fw-semibold">This model is currently unavailable</span>
          </div>
          {{/if}}

        </div>
      </div>

      <!-- DESCRIPTION -->
      <div class="description-section mt-5">
        <h4 class="fw-bold">Description</h4>
        <div class="description-text" id="descriptionText">
          {{{formatDescription singleCar.description}}}
        </div>
        <button class="btn btn-outline-dark mt-3" id="toggleDescBtn">Read More</button>
      </div>

      <!-- ACCORDION SECTION -->
      <div class="accordion-section mt-5">
        <!-- PERFORMANCE SPECIFICATIONS -->
        <div class="accordion">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            Performance Specifications <i class="bi bi-chevron-down"></i>
          </div>
          <div class="accordion-content">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th>Top Speed</th>
                  <td>{{singleCar.top_speed}}</td>
                </tr>
                <tr>
                  <th>Power (HP)</th>
                  <td>{{singleCar.power_hp}}</td>
                </tr>
                <tr>
                  <th>Engine</th>
                  <td>{{singleCar.engine}}</td>
                </tr>
                <tr>
                  <th>Transmission</th>
                  <td>{{singleCar.transmission}}</td>
                </tr>
                <tr>
                  <th>Drive Type</th>
                  <td>{{singleCar.drive_type}}</td>
                </tr>
                <tr>
                  <th>Acceleration (0-100)</th>
                  <td>{{singleCar.acceleration_0_100}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- EXTERIOR & INTERIOR -->
        <div class="accordion">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            Exterior & Interior <i class="bi bi-chevron-down"></i>
          </div>
          <div class="accordion-content">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th>Colors</th>
                  <td>{{singleCar.interiorAndExteriorColor}}</td>
                </tr>
                <tr>
                  <th>Wheels</th>
                  <td>{{singleCar.wheels}}</td>
                </tr>
                <tr>
                  <th>Upholstery</th>
                  <td>{{singleCar.upholstery}}</td>
                </tr>
                <tr>
                  <th>Design</th>
                  <td>{{singleCar.design}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TECHNOLOGY & ASSISTANCE -->
        <div class="accordion">
          <div class="accordion-header" onclick="toggleAccordion(this)">
            Technology & Assistance <i class="bi bi-chevron-down"></i>
          </div>
          <div class="accordion-content">
            <table class="table table-bordered">
              <tbody>
                <tr>
                  <th>Cameras</th>
                  <td>{{singleCar.cameras}}</td>
                </tr>
                <tr>
                  <th>Lane Assist</th>
                  <td>{{#if singleCar.lane_assist}}Yes{{else}}No{{/if}}</td>
                </tr>
                <tr>
                  <th>Sound System</th>
                  <td>{{singleCar.sound_system}}</td>
                </tr>
                <tr>
                  <th>Keyless Go</th>
                  <td>{{#if singleCar.keyless_go}}Yes{{else}}No{{/if}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Sticky Bottom Buttons (mobile only) -->
  {{!-- Sticky Bottom Buttons (mobile only) --}}
  <div class="mobile-bottom-bar d-lg-none">

    {{#if singleCar.isListed}}
    <div class="action-buttons d-flex gap-2" id="buyProductMob">
      <a class="btn btn-buy flex-fill" data-accessoryId="{{singleCar._id}}"
        data-variantId="{{getFirstVariantId singleCar}}">
        <i class="bi bi-lightning-charge me-1"></i> Buy Now
      </a>
      <a class="btn btn-cart flex-fill" id="addToCartMob" data-accessoryId="{{singleCar._id}}"
        data-variantId="{{getFirstVariantId singleCar}}">
        <i class="bi bi-cart me-1"></i> Add to Cart
      </a>
    </div>
    {{else}}
    <div class="unavailable-bar d-flex align-items-center justify-content-center">
      <i class="bi bi-exclamation-octagon-fill fs-6 me-2"></i>
      <span class="fw-semibold small">This model is currently unavailable</span>
    </div>
    {{/if}}

  </div>

</section>

<script src="/js/user/products/car/viewCarProduct.js"></script>